# December 29, 2025

Work Summary: ~8-10 hours, ~2,500-4,000 lines - Massive comic-web-scrapers overhaul: PostgreSQL integration, Redis-only cache, Atomic Avenue scraper, FastAPI web UI with ML labeling, deterministic matching, Python 3.13 upgrade, comprehensive refactoring

## Summary
Massive refactoring and feature development day for comic-web-scrapers and hipcomicscraper. Major improvements to scrapers, web UI, database integration, and ML features.

## Repositories Worked On
- `~/code/comic-web-scrapers` (36 commits)
- `~/code/hipcomicscraper` (2 commits)
- **Total: 38 commits**

## Hipcomicscraper

**Testing & Performance**
- Add pyright linter to project
- Fix: commit database writes per batch instead of single massive transaction

## Comic-Web-Scrapers

**Documentation & Cleanup**
- Update documentation to reflect current codebase state
- Clean up obsolete files and documentation
- Remove obsolete test file and update test documentation
- Docs: standardize on venv activation approach across all documentation

**Bug Fixes & Type Safety**
- Fix async search command - await coroutine properly
- Fix pyright type errors in main entry points
- Fix majority of pyright errors
- Add missing dependencies and simplify dependency management with uv
- Upgrade to Python 3.13 and update all dependencies

**Scrapers Improvements**
- Add Brotli dependency for CPG scraper HTTP decompression
- Apply ruff formatting and update pyright config, disable SSL verification for CCL
- Fix(hip): fix HipComic scraper returning 0 results
- Add verbose logging and document CPG API issues
- Fix(ML): lower synthetic data generation thresholds to find more class 2 examples
- Fix(scrapers): improve CPG and HIP scrapers reliability and update config
- Fix(scrapers): add timeout protection to cleanup to prevent indefinite hangs

**Web UI**
- Feat(web): implement comprehensive web UI with 9 new pages
- Integrate ML labeling tool into existing web UI
- Add ML labeling link to main navigation menu
- Remove obsolete files after FastAPI integration
- Improve UI: enhance ML labeling interface with git-diff and viewport-optimized layout

**Database Integration**
- Feat(db): implement comprehensive cache-to-PostgreSQL integration
- Feat(db): implement comprehensive data importers for pre-scraped data
- Feat(db): add cache metadata and invalidation config
- Fix(db): resolve cache sync service UUID serialization errors
- Fix(cache): remove FileCache implementation to eliminate file-based caching
- Phase 9: Remove file cache from Makefile and status_service
- Consolidate to single Redis cache implementation
- Remove deprecated redis_cache.py file
- Remove db/cache_manager.py, use CacheManagerService from api
- Add simple cache decorator and migrate all cached operations
- Phase 8: Update documentation to reflect Redis-only cache
- Phase 6: Update tests to remove FileCache references
- Remove file cache, make Redis the only cache backend

**ML & Matching**
- Add(listings_model): implement rule-based comic matcher as first pass before ML classification
- Add(make): add model-match recipe for testing rule-based comic matcher
- Refactor(listings_model): replace fuzzy matching with deterministic algorithm

**Atomic Avenue Scraper**
- Feat(atomic_avenue): implement scraper with models and tests
- Feat(integration): add Atomic Avenue scraper to all entry points
- Fix(atomic_avenue): convert listings to ComicListing/ComicPrice format
- Fix(cli): handle 'N/A' prices in result sorting
- Fix Atomic Avenue scraper to fetch individual seller listings
- Makefile: Add atomic_avenue to default search sources

**API & Performance**
- Fix(cache): Fix cache manager and sync service issues
- Fix(api): disable CacheSyncService to prevent type errors
- Fix Redis connection handling and graceful shutdown
- Fix(api): improve Redis error handling and increase cleanup timeout
- Refactor(api): remove cache warming from API startup, add standalone CLI
- Fix(api): use Redis for caching in balanced_cli by reading REDIS_URL env var
- Add unified comic matching API endpoint
- Fix(api): process Atomic Avenue when it's the only requested source
- Fix(api): prevent crash when processing only Atomic Avenue
- Fix 4-minute pause after search completion by optimizing cleanup
- Debug(api): add logging for source task creation

---

## Projects Legend

### comics_backend
FastAPI-based backend service for managing a comic book library database. Includes CLZ inventory integration, image management, eBay description generation using Ollama/LLMs, RESTful API endpoints, database migrations with Alembic, comprehensive test coverage, and CI/CD pipeline with Debian containers.

### ebay_assistant
React-based frontend application for eBay listing management. Features dark mode UI, image sorting, mobile-first glassmorphism design, series filtering, and integration with comics_backend API for AI-powered eBay description generation.

### cdisplayagain
Python/Tkinter-based comic book reader application focused on performance. Uses pyvips for image processing, implements threading architecture, smart preloading, parallel decoding, supports CBR/CBZ/TAR archives, and achieves 96% test coverage. Cross-platform support with macOS compatibility.

### comic-web-scrapers
Multi-source comic price scraping and ML-powered classification system. Supports Atomic Avenue, Comic Collector Live, HipComic, MyComicShop. Includes FastAPI web UI, PostgreSQL integration, Redis caching, machine learning labeling, data importers, and deterministic comic matching algorithms.

### hipcomicscraper
Specialized scraper for HipComic.com with async/await architecture. Features page pooling, retry logic, issue number extraction, HTML export, image fetching, seller filtering, shipping analysis, and database integration with CLI tools.

### pyvips
Python bindings for libvips (image processing library). Josh contributed comprehensive type hints for version 3.2.0, including hand-written bindings, operator overloads, and expanded mypy type checking across example scripts.

### vpn-torrent
Dockerized private BitTorrent setup with VPN integration. Features AirDC++ integration, VPN watchdog service for connection stability, generalized monitoring, and persistence fixes. Designed for secure file sharing.

### comic-pile
Complex task/queue management system with 3D dice rolling interface. Features narrative session summaries, staleness awareness tracking, worktree workflow guidance, task database system, manager agent coordination, pending thread tracking, and comprehensive rating forms with issues read adjustment.

### python-starter-template
Generic Python 3.13 project template with modern tooling. Includes comprehensive README, CI/CD pipeline, ruff linting, mypy type checking, pytest testing, pre-commit hooks, and Makefile-based development targets. Created by extracting reusable patterns from cdisplayagain.